---
output: 
  pdf_document:
    includes:
      before_body: Portada.tex
      in_header: 
    toc: true
    toc_depth: 3
  tables: true
include-before:
- '`\newpage{}`{=latex}'
toc-title: Contenido
urlcolor: blue
header-includes:
- \usepackage[nottoc]{tocbibind}
- \renewcommand{\listfigurename}{Lista de figuras}
- \renewcommand{\listtablename}{Lista de tablas}
- \usepackage[utf8]{inputenc}
- \usepackage[spanish]{babel}
- \usepackage{graphicx}
- \usepackage{float}
- \usepackage{lscape}
- \usepackage{amsmath}
---

\newpage

\listoffigures

\listoftables

```{r setup,                     include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	fig.align = "center",
	fig.height = 3,
	fig.pos = "H",
	fig.width = 7,
	message = FALSE,
	warning = FALSE
)
```

\newpage

# Preguntas teóricas
**Resuelva los ejercicios 8.1, 8.2, 8.4, 8.5 y 8.6, (Romer, 5a Ed). Realice estos con ayuda de su laboratorista y entregue las soluciones a máquina, utilizando LaTeX.**

## Ejercicio 8.1, Romer (5ta Edicion)

\begin{enumerate}
\item[] \textbf{8.1} Life-cycle saving. (Modigliani and Brumberg, 1954.) Consider an individual who lives from 0 to T, and whose lifetime utility is given by $U= \int_{t=0}^{T} u(C(t))\,dt$, where $ u'(\cdot)>0$, $u''(\cdot)<0$. The individual’s income is $ Y_{0}+gt$ for $ 0 \le t < R$, and $0$ forn $ R \le t \le T$. The retirement age, $R$, satisfies $0<R<T$. The interest rate is zero, the individual has no initial wealth, and there is no uncertainty.
\end{enumerate}

### Ejercicio (a)
\begin{enumerate}
\item[] \textit{a. What is the individual’s lifetime budget constraint?}
\end{enumerate}
Sabemos que el consumo máximo que pueda tener un individuo a lo largo de su vida no va a poder ser mayor al Ingreso que va a recibir a lo largo de ella (denotado por $Y(t)$), por eso podemos escribir la restricción como:
$$
\int_{t=0}^{T} C(t)\,dt \le \int_{t=0}^{T}Y(t)\,dt
$$
Ahora debemos desarrollar el lado derecho de la restricción, como el trabajador percibe dos ingresos diferentes a lo largo de su vida dependiendo si ya esta retirado podemos reescribir la integral del ingreso como:
$$
\Rightarrow \int_{t=0}^{R}Y(t)\,dt+\int_{t=R}^{T}Y(t)\,dt = \int_{t=0}^{R}(Y_{0}+gt)\,dt+\int_{t=R}^{T}0\,dt
$$
Dado que cuando el trabajador está retirado ya no acumula ingreso la segunda integral es igual a $0$, integrando obtenemos:
$$
\Rightarrow \int_{t=0}^{R}(Y_{0}+gt)\,dt = \left(Y_{0}t+\frac{gt^{2}}{2}\right) \Bigg\rvert_{0}^{R} = \left(Y_{0}R+\frac{gR^{2}}{2}\right) - \left(Y_{0}0+\frac{g0^{2}}{2}\right) = Y_{0}R+\frac{gR^{2}}{2}
$$
De tal manera que la restricción presupuestaria lo largo de su vida será:
$$
\Rightarrow \int_{t=0}^{T} C(t)\,dt \le Y_{0}R+\frac{gR^{2}}{2}
$$

### Ejercicio (b)
\begin{enumerate}
\item[] \textit{b. What is the individual’s utility-maximizing path of consumption, $C(t)$?}
\end{enumerate}

Con lo visto en clase sabemos que los supuestos de tasa de interés $r=0$ y tasa de descuento $\rho=0$ sabemos que el modelo implica que el consumo del periodo $t$ y del periodo $t+\Delta t$ son el mismo, por lo tanto el consumo está dado por la restricción presupuestaria dividida entre todos los periodos:
$$
\overline{C} = \frac{1}{T}\left (Y_{0}R + \frac{gR^{2}}{2} \right)
$$

### Ejercicio (c)
\begin{enumerate}
\item[] \textit{c. What is the path of the individual’s wealth as a function of $t$?}
\end{enumerate}

La riqueza (denotada por $W(t)$), está determinada por el ahorro durante el tiempo ($S(t)$), el cual depende de la diferencia entre el ingreso y el consumo a lo largo del tiempo, con lo cual tenemos que:
$$
W(t) = \int_{t=0}^{t}S(t)\,dt = \int_{t=0}^{t}(Y(t)-C(t))\,dt 
$$
Al igual que en el inciso a) podemos partir la integral en los periodoos donde el agente está empleado y donde no, quedando así:
$$
\Rightarrow \int_{t=0}^{t}(Y(t)-C(t))\,dt = \int_{t=0}^{R}(Y(t)-C(t))\,dt+\int_{t=R}^{t}(Y(t)-C(t))\,dt
$$
Podemos sustituir el valor del consumo que maximiza la utilidad esperada y el ingreso que se obtiene antes del retiro y después del retiro, teniendo así:
$$
\Rightarrow W(t) = \int_{t=0}^{R}\left (Y_{0} + gt-\overline{C} \right)\,dt-\int_{t=R}^{t}\overline{C}\,dt
$$
Resolviendo las integrales tenemos:
$$
\Rightarrow W(t)= \left[ Y_{0}t+\frac{gt^{2}}{2}-\overline{C}t  \Bigg\rvert_{0}^{R} \right]-\left[\overline{C}t\right \rvert_{R}^{t}]
$$
$$
\Rightarrow W(t)= \left[ Y_{0}R+\frac{gR^{2}}{2}-\overline{C}R - Y_{0}0+\frac{g0^{2}}{2}+\overline{C}0 \right]-\left[\overline{C}t -\overline{C}R \right ]
$$
$$
\Rightarrow W(t)= Y_{0}R+\frac{gR^{2}}{2}+\overline{C}t
$$
Recordando que $\overline{C} = \frac{1}{T}\left (Y_{0}R + \frac{gR^{2}}{2} \right)$ se puede reordenar de la siguiente manera:
$$
\Rightarrow W(t)=T\overline{C}-\overline{C}t=\overline{C}(T-t)
$$
Un aspecto a resaltar es que la riqueza va en aumento mientras el trabajador está empleado, es decir el ahorro es positivo de $t=0$ a $R$, mientras que se vuelve negativo de $R$ a $T$, esto se debe a que mientras que trabaja está percibiendo un ingreso y acumulandolo para consumir en su retiro.


## Ejercicio 8.2, Romer (5ta Edicion)
\begin{enumerate}
\item[] \textbf{8.2} The average income of farmers is less than the average income of non-farmers, but fluctuates more from year to year. Given this, how does the permanent-income hypothesis predict that estimated consumption functions for farmers and nonfarmers differ?
\end{enumerate}

De los supuestos que proporciona Milton Friedman para su Hipótesis del Ingreso Permanente se deducen los siguientes parámetros para un modelo de regresión lineal que busca explicar el consumo $C_i = a + bY_i + u_i$:

$$
\hat{b}=\frac{var(Y^P)}{var(Y^P)+var(Y^T)} \qquad \text{y} \qquad \hat{a}=(1-\hat{b})\overline{Y}^{P}
$$

en donde $Y^P$ representa el ingreso permanente, $Y^T$ el ingreso transitorio (i.e. $Y_t - \frac{1}{T}\sum{Y_t}$) y $\bar{Y^P}$ el ingreso permanente promedio. 


Sabemos que el ingreso transitorio de los agricultores presenta mayor fluctuación que el ingreso transitorio de los no agricultores, por lo que $var(Y^T)_A > var(Y^T)_{NA}$. También conocemos el hecho de que $\overline{Y}^P_A < \overline{Y}^P_{NA}$.

Suponiendo que $var(Y^P)$ es la misma para ambos grupos, se tiene entonces que $\hat{b}_A<\hat{b}_{NA}$. Esto implica que, en tal modelo, la pendiente del grupo no agricultor es mayor y, por tanto, que un cambio en el ingreso de ambos grupos de la misma magnitud afecta más al consumo de los no agricultores. Por otra parte, en el parámetro $\hat{a}$ se tienen dos efectos que se contraponen: $1-\hat{b}_A > 1-\hat{b}_{NA} \quad \text{y} \quad \bar{Y^P}_A<\bar{Y^P}_{NA}$, y no está claro que la ordenada para cierto grupo sea mayor, menor, o igual que la del otro.

Además, recordemos que un aumento en el ingreso incrementará el consumo solo en la medida en que aumenta el ingreso permanente. Cuando $\Delta Y^P$ es pequeño en relación con $\Delta Y^T$, poco del cambio en el ingreso $\Delta Y$ proviene del cambio en el ingreso permanente y, en consecuencia, el cambio en el consumo será menor. En el caso de los agricultores, $\Delta Y^T_A>\Delta Y^T_A$, por lo que el consumo no varía tanto en relación a $\Delta Y_A$ en comparación con los no agricultores.

## Ejercicio 8.4, Romer (5ta Edicion)
\begin{enumerate}
\item[] \textbf{8.4} In the model of Section 8.2, uncertainty about future income does not affect consumption.
Does this mean that the uncertainty does not affect expected lifetime utility?
\end{enumerate}

En esta sección se asume una forma funcional cuadrática de la utilidad. Pdemos escribir las siguientes funciones para describir el caso con certidumbre y el caso con incertidumbre, respectivamente:

$$
U = \sum_{0}^{T}(C_t-\frac{a}{2}C_t^2) \quad \text{y} \quad E[U] = E \left[ \sum_{0}^{T}(C_t-\frac{a}{2}C_t^2) \right ]
$$
Para el caso con incertidumbre, se tienen una serie de elementos y supuestos que son fundamentales para el análisis, a saber:

1. El agente espera consumir en el periodo $t$ lo mismo que consumió en el periodo 1: $C_1 = E_1[C_t]$.
2. El paso aleatorio, $e_t$, tiene una medio igual cero: $E_{k}[e_{t}] = 0 \quad \forall t,k<t$.
3. La hipótesis del ingreso permanente implica que el consumo sigue una caminata aleatoria: $C_t = C_{t-1}+e_t$

Supongamos que nos encontramos en en el periodo $t-1$ y por tanto conocemos lo que pasa en tal periodo ($E_{t-1}[C_{t-1}] = C_{t-1}$ i.e. el consumo en $t-1$ ya se sabe y opera como una constante). Incorporando los resultados anteriores en la ecuación que representa la incertidumbre, obtenemos:


\begin{equation*} 
\begin{split}
E[U]  &=  E \left [ \sum_{1}^{T}(C_t-\frac{a}{2}C_t^2) \right ] \\
      &=  E \left [ \sum_{1}^{T}(C_{t-1}+e_t-\frac{a}{2}(C_{t-1}+e_t)^2 \right ] \\
      &= E \left [ \sum_{1}^{T}(C_{t-1}+e_t-\frac{a}{2}(C_{t-1}^2+2C_{t-1}e_t+e_t^2) \right ] \\
      &=  \sum_{1}^{T} \left [E[C_{t-1}]+E[e_t]-\frac{a}{2}(E[C_{t-1}^2]+2E[C_{t-1}e_t]+E[e_t^2]) \right ]\\
      &=  \sum_{1}^{T} \left [C_{t-1}+E[e_t]-\frac{a}{2}(E[C_{t-1}^2]+2C_{t-1}E[e_t]+var[e_t]+E[e_t]^2) \right ] \\
      &=  \sum_{1}^{T} \left [C_{t-1}-\frac{a}{2}(C_{t-1}^2+var[e_t]) \right ]
\end{split}
\end{equation*}


Como $var[e_t] \geq 0$, notemos que el la utilidad de por vida del agente resulta mayor en el caso con certidumbre que bajo incertidumbre, ya que a esta última se le está restando el término $\frac{a}{2}var[e_t]$. Es decir:
$$
E[U] = \sum_{1}^{T} \left [C_{t-1}-\frac{a}{2}(C_{t-1}^2+var[e_t]) \right ] \leq \sum_{0}^{T}(C_{t-1}-\frac{a}{2}C_{t-1}^2) = U
$$


Por lo tanto, la incorporación de incertidumbre **sí** afecta a la utilidad esperada de toda la vida.

## Ejercicio 8.5, Romer (5ta Edicion)
\begin{enumerate}
\item[] \textbf{8.5} (This follows Hansen and Singleton, 1983.) Suppose instantaneous utility is of the
constant-relative-risk-aversion form, $u(C_{t})= \frac{C_{t}^{1- \theta}}{1- \theta}$, $ \theta >0 $. Assume that the real interest rate, $r$ , is constant but not necessarily equal to the discount rate, $\rho$.
\end{enumerate}

### Ejercicio (a)
\begin{enumerate}
\item[] \textit{a. Find the Euler equation relating $C_{t}$ to expectations concerning $C_{t +1}$.}
\end{enumerate}

Consideremos los dos periodos $t$ y $t+1$. Luego, la función de utilidad esperada puede escribirse como:

$$
U(C_t,C_{t+1}) = u(C_t)+\frac{1}{1+\rho}E[u(C_{t+1})]=
\frac{C_t^{1-\theta}}{1-\theta}+\frac{1}{(1-\rho)(1-\theta)}E[C_{t+1}^{1-\theta}]
$$

En general, la restricción presupuestaria está dada por:

$$
E[C_{t+1}]=(1+t)w+(1+r)C_t
$$

en donde $w$ (por *wealth*) incorpora la riqueza que existirá en $t+1$. Como puede observarse, la pendiente de la restricción es $1+r$. O sea, renunciar a una unidad de consumo hoy me permite consumir $1+r$ unidades mañana.

Siguiendo el análisis tradicional de las condiciones de maximización, tenemos que en el óptimo la relación marginal de sustitución (i.e. el ratio de la utilidad de hoy a la que se espera mañana) es igual a la pendiente de la restricción presupuestaria:

$$
 \frac{ \partial U(\cdot)}{ \partial C_t}=C^{-\theta}_t \quad \text{y} \quad \frac{ \partial  U(\cdot)}{ \partial C_{t+1}}=\frac{E[C^{-\theta}_{t+1}]}{1-\rho}.
$$
Así, si el agente está optimizando:

$$
 \frac{(1-\rho)C^{-\theta}_t}{E[C^{-\theta}_t]} = 1+r \quad \iff \quad C^{-\theta}_t=\left ( \frac{1+r}{1+\rho} \right)E[C^{-\theta}_{t+1}].
$$

### Ejercicio (b)
\begin{enumerate}
\item[] \textit{b. Suppose that the log of income is distributed normally, and that as a result the log of $C_{t+1}$ is distributed normally; let $\sigma^{2}$ denote its variance conditional on information available at time $t$. Rewrite the expression in part (a) in terms of $ln C_{t}$ , $ \mathbb{E}_{t}[lnC_{t+1}]$, $\sigma^{2}$, and the parameters $r$ , $\rho$, and $\theta$ . (Hint: If a variable $x$ is distributed normally with mean $\mu$ and variance $V$, $\mathbb{E}[e^{x}] = e^{\mu} e^{V/2}$.)}
\end{enumerate}


Tenemos que $lnC_{t+1} \sim N(E[lnC_{t+1}],\sigma^2)$. Reescribiendo la escuación obtenida anteriormente, podemos hacer las siguientes deducciones:


\begin{equation*} 
\begin{split}
-\theta ln C_t  &=  ln \left [ \frac{1+r}{1+\rho}E[C^{-\theta}_{t+1}] \right ] \\
      &=  ln(1+r)-ln(1+\rho)+lnE[C^{-\theta}_{t+1}] \\
      &=  ln(1+r)-ln(1+\rho)+lnE[e^{-\theta lnC_{t+1}}]\\
      &=  ln(1+r)-ln(1+\rho)+ln[e^{-\theta E(lnC_{t+1})}e^{\sigma^2/2}] \\
      &= ln(1+r)-ln(1+\rho)-\theta E[C_{t+1}] + \sigma^2/2 \\
lnC_t &= \frac{ln(1+ \rho)-ln(1+r)}{\theta} + E[C_{t+1}] - \frac{\sigma^2}{2\theta}
\end{split}
\end{equation*}

### Ejercicio (c)
\begin{enumerate}
\item[] \textit{c. Show that if $r$ and $\sigma^{2}$ are constant over time, the result in part (b) implies that the log of consumption follows a random walk with drift: $lnC_{t+1} = a + lnC_{t} + u_{t+1}$, where $u$ is white noise.}
\end{enumerate}

De la anterior ecuación podemos despejar $E[lnC_{t+1}]$:
$$
E[lnC_{t+1}] = lnC_t + \frac{ln(1+r)-ln(1+ \rho)}{\theta} + \frac{\sigma^2}{2\theta}
$$
Obsérvese que el (log del) consumo esperado en el siguiente periodo es igual al (log del) consumo de hoy **màs** una constante que no puede predecirse. Definamos tal constante como $a=\frac{ln(1+r)-ln(1+ \rho)}{\theta} + \frac{\sigma^2}{2\theta}$. Así, podemos escribir:

$$
E[lnC_{t+1}] = a + lnC_t + u_t.
$$

### Ejercicio (d)
\begin{enumerate}
\item[] \textit{d. How do changes in each of $r$ and $\sigma^{2}$ affect expected consumption growth, $ \mathbb{E}_{t}[lnC_{t+1}-lnC_{t}]$? Interpret the effect of $\sigma^{2}$ on expected consumption growth in light of the discussion of precautionary saving in Section 8.6.}
\end{enumerate}

Nuevamente, podemos reacomodar la ecuación obtenida anteriormente (nota: $C_t$ es conocido y además el operador esperanza es lineal):

$$
E[lnC_{t+1}-lnC_t] + \frac{ln(1+r)-ln(1+ \rho)}{\theta} + \frac{\sigma^2}{2\theta}
$$
El cambio esperado en el consumo puede analizarse mediante las derivadas parciales:

$$
\frac{\partial E(\cdot)}{ \partial r} = \frac{1}{\theta(1+r)}>0 \quad \text{y} \quad \frac{\partial E(\cdot)}{ \partial \sigma^2} = \frac{1}{2\theta}>0.
$$
Con estos resultados puede concluirse que un aumento (infinitesimal) de la tasa de interés incrementará el crecimiento esperado del consumo. Por otra parte, un aumento en la varianza (incertidumbre) aumentará el crecimiento esperado del consumo (y con ello el ahorro). Lo anterior implica que el agente ahorra precautoriamente, y se deriva de una función de utilidad con Aversión Relativa al Riesgo Constante (CRRA).

## Ejercicio 8.6, Romer (5ta Edicion)
\begin{enumerate}
\item[] \textbf{8.6} A framework for investigating excess smoothness. Suppose that $C_{t}= \left( \frac{r}{1 + r} \right) \left (A_{t} + \sum_{s=0}^{\infty} \frac {\mathbb{E}[Y_{t+s}]}{(1+r)^{s}} \right)$.
\end{enumerate}

### Ejercicio (a)
\begin{enumerate}
\item[] \textit{a. Show that these assumptions imply that $\mathbb{E}_{t}[C_{t +1}]=C_{t}$ (and thus that consumption follows a random walk) and that $ \sum_{s=0}^{\infty}\frac {\mathbb{E}_{t}[C_{t+s}]}{(1+r)^{s}}=A_{t} + \sum_{s=0}^{\infty} \frac {\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}$.}
\end{enumerate}
Sustituimos $C_{t}$ la expresión para $A_{t+1}$
$$
A_{t+1}=(1+r)(A_{t}+Y_{t}-C_{t})=(1+r)\left (A_{t}+Y_{t}-\left( \frac{r}{1 + r} \right) \left (A_{t} + \sum_{s=0}^{\infty} \frac {\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}} \right)\right)
$$
$$
\Rightarrow A_{t+1}= A_{t}+Y_{t}-r\left (\sum_{s=1}^{\infty} \frac {\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}} \right)
$$

Dado que $C_{t+1}$ depende de $A_{t+1}$
$$
C_{t+1}=\left(\frac{r}{1+r}\right)\left(A_{t+1}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t+1}[Y_{t+1+s}]}{(1+r)^s} \right)=\left( \frac{r}{1+r}\right)\left(A_{t}+Y_{t}-r\left( \sum_{s=1}^{\infty} \frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}\right)+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t+1}[Y_{t+1+s}]}{(1+r)^{s}} \right)
$$
Aplicando el valor esperado en tiempo t $\mathbb{E}_{t}$ de ambos lados de la ecuación y por propiedades de esperanza:
$$
\mathbb{E}_{t}[C_{t+1}]=\left( \frac{r}{1+r}\right)\left(A_{t}+Y_{t}-r\left( \sum_{s=1}^{\infty} \frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}\right)+\sum_{s=1}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}-Y_{t} \right)
$$
$$
\Rightarrow \mathbb{E}_{t}[C_{t+1}]=\left(\frac{r}{1+r}\right)\left(A_{t}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}} \right)
$$
Se comprueba que $\mathbb{E}_{t}[C_{t+1}]=C_t$, el consumo sigue una caminata aleatoria, los cambios de consumo dependen de cambios inesperados. De tal manera, el mejor estimador para $C_{t+s}$ es $C_{t}$, para cualquier valor $s \ge 0$. Podemos verlo como: $\mathbb{E}_{t}[C_{t+s}]=C_{t}$. Pasamos a obtener el valor presente del consumo esperado:
$$
\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[C_{t+s}]}{(1+r)^{s}}=\sum_{s=0}^{\infty}\frac{C_{t}}{(1+r)^{s}}=C_{t}\sum_{s=0}^{\infty}\frac{1}{(1+r)^{s}}=C_{t}\left(\frac{1+r}{r} \right)
$$
Dado que $\sum_{s=0}^{\infty}\frac{1}{(1+r)^{s}}\rightarrow \frac{1+r}{r}$, sustituyendo el valor de $c_{t}$ obtenemos:
$$
\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[C_{t+s}]}{(1+r)^{s}}=\left( \frac{1+r}{r}\right)\left(\frac{r}{1+r} \right)\left(A_{t}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}} \right)
$$
$$
\Rightarrow \sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[C_{t+s}]}{(1+r)^{s}}=A_{t}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}
$$

### Ejercicio (b)
\begin{enumerate}
\item[] \textit{b. Suppose that $\Delta Y_{t} = \phi \Delta Y_{t-1}+u_{t}$, where $u$ is white noise. Suppose that $Y_{t}$ exceeds $\mathbb{E}_{t-1}[Y_{t}]$ by $1$ unit (that is, suppose $u_{t} = 1$). By how much does consumption increase?}
\end{enumerate}
Partimos tomando el valor esperado de $t-1$ de $C_{t}$:
$$
\mathbb{E}_{t-1}[C_{t}]=\left(\frac{r}{1+r}  \right) \left( A_{t} + \sum_{s=0}^{\infty}\frac{\mathbb{E}_{t-1}[Y_{t+s}]}{(1+r)^{s}} \right)       
$$
Restando $c_{t}$ con $\mathbb{E}_{t-1}[C_{t}]$:
$$
C_{t}-\mathbb{E}_{t-1}[C_{t}]= \left(\frac{r}{1+r}\right)\left(A_{t}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]}{(1+r)^{s}}\right)-\left(\frac{r}{1+r}\right)\left(A_{t}+\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t-1}[Y_{t+s}]}{(1+r)^{s}} \right)
$$
$$
\Rightarrow C_{t}-\mathbb{E}_{t-1}[C_{t}]=\left(\frac{r}{1+r}\right)\left(\sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]-\mathbb{E}_{t-1}[Y_{t+s}]}{(1+r)^{s}} \right)
$$
$$
\Rightarrow \sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]-\mathbb{E}_{t-1}[Y_{t+s}]}{(1+r)^{s}}=1+\frac{1+\phi}{1+r}+\frac{1+\phi+\phi^{2}}{(1+r)^{2}}+\frac{1+\phi+\phi^{2}+\phi^{3}}{(1+r)^{3}}+...
$$
$$
\Rightarrow \sum_{s=0}^{\infty}\frac{\mathbb{E}_{t}[Y_{t+s}]-\mathbb{E}_{t-1}[Y_{t+s}]}{(1+r)^{s}}=\frac{1}{(1-\gamma)(1-\gamma\phi)}
$$
Donde $\gamma=\frac{1}{(1+r)}$, de tal manera que:
$$
\frac{1}{(1-\gamma)(1-\gamma\phi)}=\frac{(1+r)^{2}}{r(1+r-\phi)}
$$
Por lo tanto tenemos que:
$$
C_{t}-\mathbb{E}_{t-1}[C_{t}]=\left(\frac{r}{1+r}\right)\left(\frac{(1+r)^{2}}{r(1+r-\phi)}\right)= \frac{1+r}{1+r-\phi}
$$

### Ejercicio (c)
\begin{enumerate}
\item[] \textit{c. For the case of $\phi>0$, which has a larger variance, the innovation in income, $u_{t}$, or the innovation in consumption, $C_{t} - \mathbb{E}_{t-1}[C_{t}]$? Do consumers use saving and borrowing to smooth the path of consumption relative to income in this model? Explain.}
\end{enumerate}
$$
Var(C_{t}-\mathbb{E}_{t-1}[C_{t}])=Var\left(\frac{(1+r)u_{t}}{1+r-\phi}\right)=\left(\frac{1+r}{1+r-\phi}\right)^{2}Var(u_{t}) > Var(u_{t})
$$
Dado que $\left(\frac{1+r}{1+r-\phi}\right)>1$, la varianza del incremento del consumo es mayor a la varianza del incremento del ingreso. 
No podemos concluir nada sobre la forma que los agentes suaviazan el consumo con ahorro y crédito solo con este modelo.

 

```{r}
pacman::p_load(tidyverse,
               ggthemes,
               haven, readxl,
               kableExtra, ggfortify,
               cowplot, ggplot2, scales, viridis, latticeExtra,
               knitr, tinytex, reshape, lubridate, scales, reshape2, seasonal, plm, latex2exp, tibble)





set.seed(1000) #Utilizamos una semilla para poder replicar los experimentos. 
```
\newpage

## Ejercicio 2
**2. Simule una variedad de agentes que tienen ingresos permanentes diferentes e ingresos transitorios diferentes y calcule la relación entre consumo e ingreso que resulta dada una variedad de supuestos para las varianzas de cada tipo de ingreso siguiendo estos pasos:**


### (a) 

**Cree un vector de 20 ingresos permanentes aleatorios $Y_i^P$, distribuidos normalmente, con media 10 y varianza $\sigma^{P}$. Cree 20 vectores (cada uno de estos vectores representa una persona) cada uno con 100 observaciones idénticas del ingreso permanente. Grafíquelos (eje x, persona; eje y, ingreso permanente).**

```{r,   echo=FALSE,  fig.cap= "Ingreso Permanente durante 100 periodos", fig.pos='H'}

Y_p <- list()
for(i in 1:20){
  Y_p[[i]] <- rnorm(1:100, mean=10,sd=2)
} 

df_yp <- data.frame(t(matrix(unlist(Y_p), nrow=length(Y_p), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yp)[i] <- paste("I", i, sep= "")
  }


boxplot(df_yp,title="Ingreso Permanente durante 100 periodos" ,xlab="Personas", ylab="Ingreso permamente",col=rgb(.4, .2, .6, alpha = 0.4))
```
### (b) 

**Cree 20 vectores de 100 ingresos transitorios aleatorios $Y_{i,t}^{T}$, distribuidos normalmente, con media 0 y con varianza $\sigma^{T}$. Grafíquelos.**

```{r, echo=FALSE, fig.cap= "Ingreso Transitorio durante 100 periodos", fig.pos='H'}

Y_t <- list()
for(i in 1:20){
  Y_t[[i]] <- rnorm(1:100, mean=0,sd=2)
} 

df_yt <- data.frame(t(matrix(unlist(Y_t), nrow=length(Y_t), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yt)[i] <- paste("I", i, sep= "")
  }

boxplot(df_yt,title="Ingreso Transitorio durante 100 periodos", xlab="Personas", ylab="Ingreso transitorio", col=rgb(1, .6, .2, alpha = 0.4))

```

### (c) 

**Cree 20 vectores de 100 ingresos totales $Y_{i,t}$, sumando el ingreso transitorio y el permanente. Grafíquelos.**
```{r,echo=FALSE, fig.cap= "Ingreso Total durante 100 periodos", fig.pos='H'}
df_YT <- df_yp+df_yt

boxplot(df_YT,title="Ingreso Total en 100 periodos", xlab="Personas", ylab="Ingreso total", col=rgb(.2, 1, .2, alpha = 0.4))
```

### (d) 

**Cree 20 vectores de 100 errores de medición $\epsilon_{i,t}$, distribuidos normalmente, con media 0 y varianza $\sigma^{\epsilon}>0$. Grafíquelos.**
```{r, echo=FALSE, fig.cap= "Error de medición durante 100 periodos", fig.pos='H'}
e <- list()
for(i in 1:20){
  e[[i]] <- rnorm(1:100, mean=0, sd=2)
} 

df_e <- data.frame(t(matrix(unlist(e), nrow=length(e), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_e)[i] <- paste("I", i, sep= "")
  }

boxplot(df_e,title="Error de medición en 100 periodos" , xlab="Personas", ylab="Errores", col=rgb(0, .2, 1, alpha = 0.4))

```

### (e) 

**Cree  20 vectores de 100 consumos $C_{i,t}$ cada uno, de acuerdo a la siguiente regla $C_{i,t}=Y_{i}^{P}+0.1Y_{i,t}^{T}+\epsilon_{i,t}$. Grafíquelos.**

```{r, echo=FALSE, fig.cap= "Consumo durante 100 periodos", fig.pos='H'}
df_c <- df_yp + (0.1*df_yt) + df_e

boxplot(df_c,title="Consumo durante 100 periodos", xlab="Personas", ylab="Consumo", col=rgb(1, 0, 0, alpha = 0.4))

```
### (f) 

**Estime la relación lineal entre ingreso total y consumo $C_{i,t}=\alpha+\beta Y_{i,t}+\epsilon_{i,t}$. Describa el resultado de su estimación y grafíque la relación entre las observaciones del consumo y las del ingreso.**
```{r, echo=FALSE, fig.cap= "Relación Consumo~Ingreso 1", fig.pos='H'}
tiempo <- as.data.frame(rep((1:100),20))
c1 <- stack(df_c)
Y1 <- stack(df_YT)


panel_data <- cbind.data.frame(c1,Y1,tiempo)
panel_data <- panel_data[,-2]
names(panel_data) <- c("C","Y","Personas","Periodo")
LR <- plm(C~Y, data=panel_data, index= c("Personas","Periodo"), model="random")
LRG1 <- ggplot(panel_data,aes(x=Y,y=C)) + geom_point(color = "brown4", alpha=0.5) + 
  labs(title = TeX(r'(Relación Consumo~Ingreso($Var(Y^{P})=Var(Y^{T})$))'), x="Ingreso",y='Consumo', 
      colour = " ") + theme_bw() + geom_smooth(method = lm, color="darkcyan", alpha=0.3)
LRG1
LRtable <- data.frame(col1 = c(4.16373,0.58151),
                     row.names = c("Intercepto", "Pendiente"))
names(LRtable) <- c("Parámetro")
knitr::kable(LRtable,booktabs = TRUE, format = 'latex', caption = "Primera Regresión Consumo~Ingreso", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")
```
Lo primero que debemos notar es que en una regresión lineal $\hat{\beta}=\frac{Cov(Y_{i,t},C_{i,t})}{Var(Y_{i,t})}=\frac{1}{1+\frac{Var(Y_{i}^{T})}{Var(Y_{i}^{P})}}$. De tal manera que si consideramos el valor de 2 para la desviación estándar ($sd^{2}=Var$) para ambas variables obtenemos que $\hat{\beta}=\frac{1}{2}$, lo cual es muy cercano a lo que obtuvimos con la regresión lineal con datos panel, esto quiere decir que las variaciones del Ingreso Total provienen en la misma medida a variaciones en el Ingreso permanente y el Ingreso Transitorio, con lo cual un aumento de una unidad de Ingreso Total lleva a un aumento de .5 unidades el consumo. 

### (g) 

**Incremente la varianza del ingreso permanente, y disminuya la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.**
```{r, echo=FALSE,fig.cap= "Relación Consumo~Ingreso 2", fig.pos='H' }
Y_p2 <- list()
for(i in 1:20){
  Y_p2[[i]] <- rnorm(1:100, mean=10, sd=2.5)
} 

df_yp2 <- data.frame(t(matrix(unlist(Y_p2), nrow=length(Y_p2), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yp2)[i] <- paste("I", i, sep= "")
  }

Y_t2 <- list()
for(i in 1:20){
  Y_t2[[i]] <- rnorm(1:100, mean=0, sd=1.5)
} 

df_yt2 <- data.frame(t(matrix(unlist(Y_t2), nrow=length(Y_t2), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yt2)[i] <- paste("I", i, sep= "")
  }

df_YT2 <- df_yp2+df_yt2

Y2 <- stack(df_YT2)
df_c2 <- df_yp2 + (0.1*df_yt2) + df_e
c2 <- stack(df_c2)

panel_data2 <- cbind.data.frame(c2,Y2,tiempo)
panel_data2 <- panel_data2[,-2]
names(panel_data2) <- c("C","Y","Personas","Periodo")
LR2 <- plm(C~Y, data=panel_data2, index= c("Personas","Periodo"), model="random")
LRG2 <- ggplot(panel_data2,aes(x=Y,y=C)) + geom_point(color = "cadetblue4", alpha=0.5) + 
  labs(title = TeX(r'(Relación Consumo~Ingreso($Var(Y^{P})>Var(Y^{T})$))'), x="Ingreso",y='Consumo', 
      colour = " ") + theme_bw() + geom_smooth(method = lm, color="darkgoldenrod1", alpha=0.3)
LRG2
LRtable2 <- data.frame(col1 = c(2.28750,0.77132),
                     row.names = c("Intercepto", "Pendiente"))
names(LRtable2) <- c("Parámetro")
knitr::kable(LRtable2,booktabs = TRUE, format = 'latex', caption = "Segunda Regresión Consumo~Ingreso", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")
```
Retomamos la fórmula del inciso anterior $\hat{\beta}=\frac{1}{1+\frac{Var(Y_{i}^{T})}{Var(Y_{i}^{P})}}$, nos arroja un valor de $\hat{\beta}\approx.73$, lo cual de nuevo concuerda con nuestros resultados de la regresión estimada. Esto quiere decir que un aumento del Ingreso Total es más probable de ser de un aumento del Ingreso Permanente, un aumento de una unidad de Ingreso Total lleva a un aumento de .77 (valor de $\hat{\beta}$ de la regresión) unidades de Consumo.
### (h) 

**Disminuya la varianza del ingreso permanente, y aumente la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.**

```{r, echo=FALSE, fig.cap= "Relación Consumo~Ingreso 3", fig.pos='H'}
Y_p3 <- list()
for(i in 1:20){
  Y_p3[[i]] <- rnorm(1:100, mean=10,sd=1.5)
} 

df_yp3 <- data.frame(t(matrix(unlist(Y_p3), nrow=length(Y_p3), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yp3)[i] <- paste("I", i, sep= "")
  }

Y_t3 <- list()
for(i in 1:20){
  Y_t3[[i]] <- rnorm(1:100, mean=0,sd=2.5)
} 

df_yt3 <- data.frame(t(matrix(unlist(Y_t3), nrow=length(Y_t3), byrow=TRUE))) #I para cada individuo.
  for(i in 1:20){
    names(df_yt3)[i] <- paste("I", i, sep= "")
  }

df_YT3 <- df_yp3+df_yt3

Y3 <- stack(df_YT3)
df_c3 <- df_yp3 + (0.1*df_yt3) + df_e
c3 <- stack(df_c3)

panel_data3 <- cbind.data.frame(c3,Y3,tiempo)
panel_data3 <- panel_data3[,-2]
names(panel_data3) <- c("C","Y","Personas","Periodo")
LR3 <- plm(C~Y, data=panel_data3, index= c("Personas","Periodo"), model="random")
LRG3 <- ggplot(panel_data3,aes(x=Y,y=C)) + geom_point(color = "aquamarine3", alpha=0.5) + 
  labs(title = TeX(r'(Relación Consumo~Ingreso($Var(Y^{P})<Var(Y^{T})$))'), x="Ingreso",y='Consumo', 
      colour = " ") + theme_bw() + geom_smooth(method = lm, color="darkmagenta", alpha=0.3)
LRG3
LRtable3 <- data.frame(col1 = c(6.70659,0.32859),
                     row.names = c("Intercepto", "Pendiente"))
names(LRtable3) <- c("Parámetro")
knitr::kable(LRtable3,booktabs = TRUE, format = 'latex', caption = "Tercera Regresión Consumo~Ingreso", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")
```
Hacemos lo mismo que en el inciso anterior y obtenemos $\hat{\beta}\approx.26$, es decir, es más probable que una variación del Ingreso Total provenga de un aumento en el Ingreso Transitorio, esto lleva a que un incremento de una unidad de Ingreso Total solo produzca un aumento de .32 unidades de Consumo.

\newpage

## Ejercicio 3
**Estudie el consumo agregado en México siguiendo estos pasos:**

```{r, include=FALSE}
## Cargamos el excel con las variables ya trabajadas (base=2013)

variables<-read.csv("variables.csv")
View(variables)
##Generamos el t.consumo:
consumo<-variables[,1]
c=ts(consumo,start=1993,frequency=4)
## Generamos el t.ingreso:
ingreso<-variables[,5]
y=ts(ingreso, start=1993, frequency=4)
## Generamos la t.inversión:
inversion<-variables[,8]
I=ts(inversion,start=1993,frequency=4)
## Generamos la t. gasto:
gasto<-variables[,13]
G=ts(gasto,start=1993,frequency=4)
## Generamos la t.XN:
balanza<-variables[,18]
XN=ts(balanza,start=1993,frequency=4)
```

```{r                   echo=FALSE, include=FALSE}
## Para hacerlas comparables, mejor las estandarizamos:
#Consumo
cs<-as.data.frame(scale(consumo,center=TRUE,scale=TRUE))
cst=ts(cs,start=1993,frequency=4)
plot(cst)
#Ingreso
ys<-as.data.frame(scale(ingreso,center=TRUE,scale=TRUE))
yst=ts(ys,start=1993,frequency=4)
plot(yst)
#Inversión
Is<-as.data.frame(scale(inversion,center=TRUE,scale=TRUE))
Ist=ts(Is,start=1993,frequency=4)
plot(Ist)
#Gasto
gs<-as.data.frame(scale(gasto,center=TRUE,scale=TRUE))
gst=ts(gs,start=1993,frequency=4)
plot(gst)
#XN
xns<-as.data.frame(scale(balanza,center=TRUE,scale=TRUE))
xnst=ts(xns,start=1993,frequency=4)
plot(xnst, main="Exportaciones netas 2002-2021", col="black")
```

### a)  

**Obtenga, del Inegi, datos de “C”, el consumo agregado en México, de “Y”, elproducto agregado, de “I”, la inversión agregada, de “G”, el gasto del gobierno y de , de “NX”, las exportaciones netas, entre 1980 y el tercer trimestre de 2019,EN TÉRMINOS REALES**

Se obtuvieron las siguientes series:

+ Serie desestacionalizada: Indicador Mensual del Consumo Privado en el Mercado Interior (en adelante "C") de base 2013 [^1].

[^1]: Vale la pena hacer la siguiente aclaración: la series disponibles en INEGI son del periodo 1993-2021. El ejercicio pide desde el año 1980, pero algunas series disponibles en la estadístia oficial datan de 1993 dado que, a partir de 1994 se homologaron metodologías estadísticas entre los países parte del *TMEC* y se ajustaron a base 2013=100, por lo que la búsqueda de datos anteriores a esta homologación podría resultar difícil para trabajar y significaría un trabajo estadístico de datos (para hacer las series comparables) que excede los propósitos de esta tarea, por lo que las series se tomaron para todo el periodo disponible, a reserva de que la tendencia, básicamente, se mantiene y las conclusiones que podemos sacar del análisis no variarían significativamente. 

+ Serie desestacionalizada: Producto Interno Bruto (en adelante "Y") a precios 2013. 
+ Serie desestacionalizada: Inversión Bruta Fija (en adelante "I") de base 2013. 
+ Serie desestacionalizada: Gasto programable (en adelante "G") a precios 2013 [^2].
+ Serie desestacionalizada: Balanza comercial (en adelante "XN") a precios 2013 [^3].

[^2]: Esta serie se desestacionalizó aparte, dado que fue descargada en niveles de Banxico. El Gasto se divide en gasto de capital y gasto corriente. Decidimos tomar el gasto programable ya que es el que se planea ejercer en el presupuesto de cada año, aunque, además, hay un gasto no programable, que es aquel que se ejerce y que no estaba presupuestado.  
[^3]: Íbidem. 


Ahora, para obtener las series en términos reales, las deflactamos con el INPC. Esto se hace solamente con las variables $G$ y $XN$ ya que éstas son variables en niveles. De aquí en adelante, las series se presentan en términos reales, desestacionalizadas y de base 2013. 

Aprovecharemos, en este inciso, para mostrar el proceso por el cual se desestacionalizó la variable $G$ así como $XN$. Lo primero es identificar que toda serie de tiempo tiene 4 componentes, a saber: ciclo, tendencia, estacionalidad e irregularidad. Se descompuso la serie en sus 4 componentes, que para el caso de $G$ se observan a continuación:

```{r echo=FALSE, fig.cap= "Descomposición de la serie G", fig.pos='H', fig.height=7}
## Tenemos que desestacionalizar la serie de G y de XN:
# Ajuste estacional por Census X11:G
gstd<-decompose(gst,"additive")
autoplot(gstd,xlab="Tiempo", ylab=" ", main = " ") + theme_bw()
grstd<-unlist(gstd[[3]])

```

De esta descomposición solamente obtenemos el componente de la tendencia para la variable $G$. Lo mismo sucede para la variable $XN$. 

Las series que se trabajarán a lo largo de este ejercicio son las que siguen: 

```{r       echo=FALSE,fig.cap= "Variables macroeconómicas seleccionadas", fig.pos='H', fig.height = 9, warning=FALSE       }
## Todas juntas:
unidas<-ts.union(cst,yst,Ist,grstd,xnst)
autoplot(unidas,xlab="Tiempo", ylab=" ",main=" ") + theme_bw()

```

Nótese que las variables están suavizadas y normalizadas, así como están en términos reales a precios 2013. Notemos que la variación y la tendencia entre las variables $Y_t$, $I_t$ y $C_t$ es muy similar, lo que indica que hay un grado de asociación entre dichas variables muy importante. Notemos que esto puede tener alguna implicación en los resultados econométricos que se analizarán en el inciso f). 

### b)  

**Grafique dichas serie de tiempo juntas para comparalas visualmente. (Compare la gráfica de las variables (de las que son siempre positivas) en dos versiones: a)su valor real original, y b) después de sacarles el logaritmo natural).**

#### b.1) Graficando en su valor original

Para realizar este inciso tuvimos que normalizar las variables para hacerlas comparables, esto debido a que los valores máximos y mínimos de estas son muy disímiles. La normalización se dio a través de la siguiente fórmula:

$$
Z_i=\frac{X_i- \mu}{\sigma}
$$

Donde $x_i$ es cada una de las observaciones de las series para cada $t_i$, con $t_i \in[1993I-2021IV]$ lo que nos devolverá un nuevo valor $z_i$ para $t_i\in[1993I-2021IV]$, de esta forma no se pierde ninguna observación y sólo se modifica la escala, lo que nos permite hacer comparaciones entre las variables. En la siguiente gráfica se muestran las variables en niveles: $C$, $Y$, $I$ y $G$. 

```{r    echo=FALSE, fig.cap= "Variables seleccionadas: 1993-2022", fig.pos='H', fig.height=9}
juntas<-ts.union(cst,yst,Ist,grstd,dframe=FALSE)
autoplot(juntas, ylab="CYIG",xlab="Tiempo",main="") + theme_bw()
```

Nótese que estas variables tienen un comportamiento similar. En todo el periodo la tendencia es creciente, con una caída importante durante la pandemia y a partir del Gobierno de Andrés Manuel López Obrador. Nótese, además, que el $G$ tuvo una caída menor, pues a partir de la crisis económica generada por la pandemia el gobierno en turno incentivó la economía a través de una política fiscal expansiva. 

#### b.2) Graficando su ln

Para realizar este inciso se tomaron los $ln(x_i)$ donde $x_i$ es cada variable analizada. En este caso tenemos lo que sigue: $ln(c), ln(Y), ln(I)$ y $ln(G)$ [^4].

[^4]: Nótese que, para el caso de la variable $ln(G)$, al normalizarla, los valores para el logaritmo natural son negativos, por lo que no se alcanzan a ver en la gráfica. No es sino hasta el tercer trimestre de 2009 que los valores son positivos y pueden compararse. 

Notamos que el comportamiento tendencial de las variables se mantiene: hay una tendencia creciente en el periodo con una variación negativa durante los últimos años del periodo debido a las razones que ya mencionamos.

```{r         echo=FALSE,include=FALSE,       warning=FALSE}
## Tomamos ahora las variables en ln

lnc<-variables[,2]
lny<-variables[,6]
lnI<-variables[,9]
lnG<-log(grstd)
lncts<-ts(lnc,start=1993,frequency=4)
lnyts<-ts(lny,start=1993,frequency=4)
lnIts<-ts(lnI,start=1993,frequency=4)
lnGts<-ts(lnG,start=1993,frequency=4)
lnjuntas<-ts.union(lncts,lnyts,lnIts,lnGts,dframe=FALSE)
```

```{r echo=FALSE,                                   include=TRUE, fig.cap= "Variables seleccionadas en logaritmo: 1993-2022", fig.pos='H', fig.height=9}
autoplot(lnjuntas,ylab="LogX",xlab="Tiempo",main="") + theme_bw()
```

### c) 

**Grafique también la tasa de crecimiento de todas estas series**

La tasa de crecimiento de cada una de las series está dada por la siguiente ecuación:

$$
\Delta{x_t}=(X_t - X_{t-1}) / X_{t-1} \times 100
$$

Donde cada $\Delta{x_t}$ es un valor para el tiempo $t$ que medirá la variación que tuvo cada observación respecto al tiempo $t-1$. Este valor está expresado en porcentaje. 

En la siguiente gráfica observamos las variaciones de las variables seleccionadas.

```{r                echo=FALSE,include=TRUE,warning=FALSE}
## Trabajamos con las variaciones:
dc<-variables[,3]
dy<-variables[,7]
dI<-variables[,10]
dG<-variables[,15]
dXN<-variables[,19]
## Generamos el time series de cada X:
dcts<-ts(dc,start=1993,frequency=4)
dyts<-ts(dy,start=1993,frequency=4)
dIts<-ts(dI,start=1993,frequency=4)
dGts<-ts(dG,start=1993,frequency=4)
dXNts<-ts(dXN,start=1993,frequency=4)
```

```{r echo=FALSE, fig.cap= "Variaciones porcentuales de variables seleccionadas: 1993-2022", fig.pos='H', fig.height=7.5, warning=FALSE}
## Generamos la gráfica completa:
varuni<-ts.union(dcts,dyts,dIts,dGts,dXNts,dframe=FALSE)
plot(varuni,xlab="Tiempo",main="")
```


Notemos que $\Delta{C_t}$, $\Delta{Y_t}$ y $\Delta{I_t}$ son muy similares, esto debido a la correlación que existe entre las variables. Por otro lado, $\Delta{G_t}$ y $\Delta{XN_t}$ tienen una dinámica distinta. Notemos, además, que $\Delta{XN_t}$ es una serie que decrece, pues México tiene una dinámica de déficit comercial, es decir, que en México para $t\in[2002-2021]$ se cumple que $X_t \leq M_t$, luego entonces, $XN_t\leq0$. Véase también que, en el caso de $\Delta{G_t}$ las variaciones son muy altas, es decir, es más volatil. Esto se explica porque el gasto programable varía en función de los recursos disponibles del Gobierno en cada periodo $t$ y, además, de las proyecciones que se tienen respecto al comportamiento de las variables clave que financian el $G$. Estas variables son ,*grosso modo*, el precio del petróleo y el índice de recaudación fiscal. 

### d) 

**Enfóquese ahora nada más al consumo y al producto agregado. Grafique la relación entre una serie y la otra, es decir, grafique los puntos ($\Delta{Y_t}$, $\Delta{C_t}$) poniendo el consumo en las ordenadas**

Esta variación conjunta entre $\Delta{C_t}$ y $\Delta{Y_t}$ no es clara si graficamos como la gráfica que sigue, sin embargo, nótese que esta relación es positiva, es decir, intuitivamente podemos decir que las variaciones positivas de $Y_t$ se relacionan con variaciones positivas de $C_t$.

```{r         echo=FALSE, include=TRUE, fig.cap= "Relación entre Y y C", fig.pos='H', fig.height=6, warning=FALSE}
## Graficamos Y y C:

plot(dc,dy,ylab="Variación consumo", xlab="Variación ingreso",type="p")
```

Notemos que esta relación es difícil de ver, dado que las variaciones son muy disímiles. Hagamos ahora la comparación con las variables en logaritmos. En la siguiente gráfica se muestra esta relación. 

```{r echo=FALSE,             include=TRUE, fig.cap= "Relación entre ln(Y) y ln(C)", fig.pos='H', fig.height=6, warning=FALSE}
##Graficamos

plot(lnc,lny,ylab="Consumo",xlab="Ingreso")

```

Nótese que esta relación es positiva, es decir, la variación del consumo y del ingreso tiene un alto nivel de correlación. Esta relación nos indica que el consumo crece conforme crece el ingreso, es decir, guardan una relación directa [^5].

[^5]: Notemos que esta es la relación que esperaríamos siguiendo la macroeconomía Keynesiana. Más adelante, estableceremos formal y econométricamente esta relación, buscando calcular la propensión marginal al consumo en el modelo 1 a estimar en el inciso f. 

### e) 

**Calcule la volatilidad de las dos series. ¿Qué es más volatil, el consumo o el ingreso?**

Sabemos que la volatilidad de un conjunto de datos está dada por la raíz cuadrada de la varianza, es decir, por la siguiente ecuación:

$$
S_n=\sqrt{\sigma^2}
$$

A su vez, sabemos que la varianza $\sigma^2$ se define como sigue:

$$
\sigma^2=\frac{1}{n}\sum(x_i-\mu)^2
$$

Donde la varianza de $C_t$ está dada por lo siguiente:

```{r echo=FALSE,            include=FALSE}
var(consumo)
sd(consumo)
var(ingreso)
sd(ingreso)
summary(consumo)
summary(ingreso)
```

Notemos entonces que los datos son los siguientes:

\begin{equation}
\begin{bmatrix}
Varianza C & Varianza Y 
\end{bmatrix}
\end{equation}



\begin{center}
$=$
\end{center}

\begin{equation}
\begin{bmatrix}
321.896 & 251.7195
\end{bmatrix}
\end{equation}

Mientras que las desviaciones estándar están dadas por lo que sigue:

\begin{equation}
\begin{bmatrix}
Desviación C & Desviación Y 
\end{bmatrix}
\end{equation}

\begin{center}
$=$
\end{center}

\begin{equation}
\begin{bmatrix}
17.94 & 15.86
\end{bmatrix}
\end{equation}

Con esto podemos dar cuenta que es el consumo el que presenta una variación ligeramente mayor y, por ende, es más volátil. Ahora, esto puede deberse a que la variación en el ingreso está *suavizada* por las variaciones de los demás componentes, incluida la variación del consumo. 

### f) 

**Estimar algunos modelos de regresión lineal:**

Estimamos los siguientes modelos de regresión lineales:

+ $C_t=a + bY_t+\epsilon_t$
+ $\Delta_{C_t}=a+b\Delta_{Y_t}+\epsilon_t$
+ $\Delta_{C_t}=a+b\Delta_{Y_t-1}+\epsilon_t$
+ $ln(c_t)=a+bln(y_t)+\epsilon_t$

1. Los resultados para el primer modelo, $C_t=a + bY_t+\epsilon_t$, se muestran a continuación:

$C_t=-000000.5+09.9Y_t$

Es decir, que a cambios en $Y_t$ el consumo responderá de forma directa en un 9.9, lo que viene dado por el coeficiente $b=09.9$. 

Notemos que el valor para el intercepto es muy cercano a 0, por lo que asumimos que $a=0$.

Esta regresión se grafica en la siguiente tabla. Nótese que la relación es directa y que el consumo está suficientemente explicado por el ingreso. 

Notemos que la propensión marginal a consumir es igual a 0.9, es decir, que cambios en el ingreso se traducen casi proporcionalmente a cambios en el consumo, siendo la diferencia, es decir, 0.1, la propensión marginal a ahorrar.

```{r  echo=FALSE,     fig.cap="Modelo 1", fig.height=5,     include=TRUE,warning=FALSE    }
#Modelo 1:
regresion1<-lm(cst~yst,data=cst)
## Graficamos
plot(consumo,ingreso,xlab="Ingreso",ylab="Consumo")
## Agregamos la regresión
abline(regresion1)
```

Ahora notemos los errores. Eston están dados en la siguiente gráfica. Notemos que estos errores presentan un patrón, lo que indica que hay asociación lineal entre las variables. En el resumen de los estadísticos de la regresión notaremos esta salvedad de la regresión:

```{r  echo=FALSE,          fig.cap="Errores Modelo 1", fig.height=5,           include=TRUE,  warning=FALSE}
## Obtenemos los residuos
residuos1<-rstandard(regresion1)
##Los ajustamos
valoresajustados<-fitted(regresion1)
##Graficamos los ajustados vs los residuos
plot(valoresajustados,residuos1,ylab="residuos",xlab="ajustados")
abline(h=0)
```

La siguiente tabla muestra los resultados:

|  **Coef.** 	| **Estimado** 	| **Std. Error** 	| **T_value** 	|
|:----------:	|--------------	|----------------	|-------------	|
| intercepto 	| -5.510e-16   	| 00.1212        	| 0.00        	|
|      Y     	| 09.915       	| 00.1218        	| 81.42       	|
|     R^2    	| 0.9831       	| Adjusted R^2   	| 0.9829      	|

Notemos que la $R^2$ ajustada es muy alta, es decir, que el consumo se explica completamente por el ingreso. Como ya mencionamos, este resultado indica que hay asociación lineal entre las variables pues la *bondad de ajuste* es cercana al 100%. 

2. Ahora estimemos el segundo modelo de regresión lineal, de acuerdo con la ecuación que sigue:

$\Delta_{C_T}=a+b\Delta_{Y_t}+\epsilon_t$

Los resultados se muestran a continuación:

$\Delta_C=4.30+0.8\Delta_y$

Esta regresión se grafica en la siguiente tabla. Nótese que la relación es directa y que las variaciones en el consumo están suficientemente explicadas por las variaciones en el ingreso. 

Notemos que la propensión marginal a consumir es igual a 0.8, es decir, que cambios en el ingreso se traducen casi proporcionalmente a cambios en el consumo, siendo la diferencia, es decir, 0.2, la propensión marginal a ahorrar.

```{r echo=FALSE, include=TRUE, fig.cap="Modelo 2", fig.height=5,   warning=FALSE}
#Modelo 2:
regresion2<-lm(dc~dy,data=dcts)
## Graficamos
plot(dc,dy,xlab="% Ingreso",ylab="% Consumo")
## Agregamos la regresión
abline(regresion2)
```

Ahora notemos los errores. Eston están dados en la siguiente gráfica. Notemos que estos errores no se distribuyen aleatoriamente, lo que indica que hay asociación lineal entre las variables. En el resumen de los estadísticos de la regresión notaremos esta salvedad de la regresión.

```{r  echo=FALSE,          fig.cap="Errores Modelo 2", fig.height=5,         include=TRUE,  warning=FALSE}
## Obtenemos los residuos
residuos2<-rstandard(regresion2)
##Los ajustamos
valoresajustados2<-fitted(regresion2)
##Graficamos los ajustados vs los residuos
plot(valoresajustados2,residuos2,ylab="residuos",xlab="ajustados")
abline(h=0)
```
A continuación se muestran estos estadísticos:

|  **Coef.** 	| **Estimado** 	| **Std. Error** 	| **T_value** 	|
|:----------:	|--------------	|----------------	|-------------	|
| intercepto 	| 4.300e01     	| 00.802         	| 0.536       	|
|      Y     	| 08.000       	| 00.135         	| 0.70        	|
|     R^2    	| 0.9882       	| Adjusted R^2   	| 0.9168      	|

Notemos que la $R^2$ ajustada es muy alta, es decir, las variaciones en el consumo se explican completamente por las variaciones en el ingreso. Como ya mencionamos, este resultado indica que hay asociación lineal entre las variables pues la *bondad de ajuste* es mayor al 90%.

3. Ahora estimemos el tercer modelo de regresión lineal el cual está dado por la ecuación que sigue:

$\Delta_{C_t}=a+b\Delta_{Y_t-1}+\epsilon_t$

Este modelo nos presenta una variable rezagada, es decir, lo que buscamos analizar es si el ingreso afecta al consumo pero no en el mismo periodo, es decir, queremos ver cómo afectan las variaciones en el ingreso en $t-1$ al consumo en $t$. 

Los resultados se muestran a continuación:

$\Delta_{C_t}=+\Delta_{Y_t-1}$

Los estadísticos se muestran en la siguiente tabla:

|  **Coef.** 	| **Estimado** 	| **Std. Error** 	| **T_value** 	|
|:----------:	|--------------	|----------------	|-------------	|
| intercepto 	| 57.73     	| 1.0857       	| 48.57       	|
|      Y     	| 0.46927       	| 0.01262         	| 37.20        	|
|     R^2    	| 0.937       	| Adjusted R^2   	| 0.9556      	|

Notemos que la $R^2$ ajustada es muy alta, es decir, las variaciones en el consumo se explican completamente por las variaciones en el ingreso. Como ya mencionamos, este resultado indica que hay asociación lineal entre las variables pues la *bondad de ajuste* es mayor al 90%.


4. Ahora estimemos el cuarto modelo de regresión lineal el cual está dado por la ecuación que sigue:

$ln(c_t)=a+bln(y_t)+\epsilon_t$

Los resultados se muestran en la ecuación que sigue:

$ln(c_t)=-14.27+1.13ln(y_t)+\epsilon_t$

Es decir, que a cambios en $Y_t$ el consumo responderá de forma directa en un 1.13, lo que viene dado por el coeficiente $b=1.13$. 

Esta regresión se grafica en la siguiente tabla. Nótese que la relación es directa y que el logaritmo del consumo está suficientemente explicado por el logaritmo del ingreso. 

Notemos que la propensión marginal a consumir es igual a 1.13, es decir, que cambios en el logaritmo del ingreso se traducen más que proporcionalmente a cambios en el logaritmo del consumo.

```{r  echo=FALSE,     fig.cap="Modelo 4", fig.height=5,      include=TRUE,   warning=FALSE}
#Modelo 4:
regresion4<-lm(lnc~lny,data=lncts)
## Graficamos
plot(lnc,lny,xlab="ln(y)",ylab="ln(c)")
## Agregamos la regresión
abline(regresion4)
```

Ahora notemos los errores. Eston están dados en la siguiente gráfica. Notemos que estos errores presentan un patrón, lo que indica que hay asociación lineal entre las variables. En el resumen de los estadísticos de la regresión notaremos esta salvedad de la regresión:

```{r  echo=FALSE,            fig.cap="Errores Modelo 4", fig.height=5,         include=TRUE,  warning=FALSE}
## Obtenemos los residuos
residuos4<-rstandard(regresion4)
##Los ajustamos
valoresajustados4<-fitted(regresion4)
##Graficamos los ajustados vs los residuos
plot(valoresajustados4,residuos4,ylab="residuos",xlab="ajustados")
abline(h=0)
```

La siguiente tabla muestra los resultados:

|  **Coef.** 	| **Estimado** 	| **Std. Error** 	| **T_value** 	|
|:----------:	|--------------	|----------------	|-------------	|
| intercepto 	| -14.2753   	| 0.2471        	| -57.77        	|
|      Y     	| 1.1381       	| 0.0150          	| 75.87       	|
|     R^2    	| 0.9806       	| Adjusted R^2   	| 0.9804      	|

Notemos que la $R^2$ ajustada es muy alta, es decir, que el logaritmo del consumo se explica completamente por el logaritmo del ingreso. Como ya mencionamos, este resultado indica que hay asociación lineal entre las variables pues la *bondad de ajuste* es cercana al 100%. Por tanto, los coeficientes calculados son no estadísticamente significativos. 

### g) 

**Explique qué se podría concluir, si fuera el caso, acerca de la Hipótesis de Ingreso Permanente para México a partir de los coeficientes encontrados**

A partir de todo el análisis hecho podemos concluir lo siguiente: i. Que la HIP no explica el comportamiento del consumo agregado en la economía mexicana para el periodo de observación. Este periodo abarca de 1993 a 2021, es decir, un periodo de 28 años. Esto implica que, a pesar de que el consumo tiene un comportamiento poco volatil y con aumentos muy cercanos a los aumentos del ingreso agregado, éste está determinado, empíricamente, por las variaciones en el ingreso. De hecho, podemos concluir que este efecto de sigue del efecto multiplicador Keynesiano debido a que el consumo depende del ingreso y éste último también del consumo, siendo el indicador importante *la propensión marginal a consumir*. 

Esta propensión explica qué porcentajes de las variaciones en el ingreso se traducen como variaciones directas en el consumo, y este comportamiento se explica, esencialmente, por el modelo Keynesiano de consumo. ii. No es posible eliminar la correlación que existe entre las variables $C_t$ y $Y_t$ debido a la forma en la que se construyen. No obstante, los modelos econométricos estimados nos confirman la relación que teóricamente construimos entre las variables desde el modelo lineal de consumo de la macroeconomía Keynesiana. Un análisis econométrico más robusto excede el alcance de esta tarea, sin embargo, es un área de oportunidad a explorar debido a que podríamos estimar con mayor precisión cuál es la relación causal entre las variables y estimar si es que las variaciones del ingreso, por ejemplo, impactan pero no inmediatamente las variaciones en el consumo y hasta qué rezago se logra absorber ese efecto. 

Como conclusión, no es difícil demostrar que la HIP no se sostiene para el caso de México, en el periodo observado, sin embargo, en línea con las implicaciones empíricas expuestas en Romer, un análisis más robusto implicaría identificar las variaciones del consumo que provienen de variaciones permanentes o transitivas en el ingreso, por lo que esta hipótesis no puede ser desechada completamente y más bien haría falta hacer un análisis econométrico enfocado en clasificar las variaciones transitivas y/o permanentes en el ingreso.

```{r echo=FALSE,   include=FALSE}
## Tenemos que desestacionalizar la serie de G y de XN:
# Ajuste estacional por Census X11:G
gstd<-decompose(gst,"additive")
plot(gstd)
grstd<-unlist(gstd[[3]])
plot(grstd)

#Ajuste estacional por Census X11: XN
xnsd<-decompose(xnst,"additive")
xnstd<-unlist(xnsd[[3]])
plot(xnstd,main="Exportaciones Netas, 2002-2021",sub="Fuente: Elaboración propia con base en Banxico", ylab="exportaciones netas", xlab="tiempo")
```

\newpage

## Ejercicio 4
**4. Estudie el consumo de los individuos en México, siguiendo estos pasos:**


### (a) 

**Baje los datos de un año de la ENIGH del sitio del INEGI, (Cada grupo va a utilizar unos datos diferentes: Grupo 1-2020, Grupo 2-2018, Grupo 3-2016, ..., etc.)  y establezca el número de hogares y el ingreso y el gasto promedio.**

La Encuesta Nacional de Ingresos y Gastos de los Hogares provee un desglose muy detallado sobre el consumo de los hogares, así como de sus ingresos y su procedencia. Esta encuesta se publica cada dos años.

La tabla **CONCENTRADOGASTO** contiene las variables construidas, a partir de las tablas de la base de
datos, que permiten tener agrupada la información con la cual se obtienen los principales tabulados que el INEGI
construye.

Dado que este trabajo es del equipo 1, se utilizarán los datos del 2020. Las principales variables que se utilizarán son las siguientes:

1) Folio de la vivienda: **folioviv**
2) Folio del hogar: **foliohog**
3) Ubicación geográfica: **ubica_geo**
5) Ingreso corriente del hogar: **ing_cor**
6) Gasto corriente monetario: **gasto_mon**

```{r echo=FALSE}
#Descarga de datos del INEGI
concgast <- read.csv("conjunto_de_datos2020/conjunto_de_datos/conjunto_de_datos_concentradohogar_enigh_2020_ns.csv", sep = ",")


knitr::kable(
  head(select(concgast, folioviv, foliohog, ubica_geo,ing_cor,gasto_mon), 10), booktabs = TRUE, align = "c",format = 'latex', digits = 2,
  caption = "Algunas variables de la ENIGH"
)%>%
  kable_styling(latex_options = "HOLD_position")

```


### (b) 

**Estime una relación entre ingreso y gasto y reporte sus resultados.**

Se estandarizaron las observaciones del ingreso y el gasto (que representa el consumo) para no trabajar con datos de valores tan altos. Considerando todas las observaciones, se obtuvo un parámetro de 0.292, el cual implica que cuando el ingreso aumenta en 10 unidades monetarias, el gasto en consumo aumentará en casi 3 pesos. Este resultado se acompaña de una gráfica en la que se representa al consumo (gasto) en función del ingreso.

```{r echo=F, fig.pos='H', fig.cap="Consumo vs Ingreso (2020)"}

#Definimos las variables como objetos para poder trabajar con ellas.

ingr <- concgast$ing_cor
gasmon <- concgast$gasto_mon

# Vamos a estandarizar las observaciones poder estimar de mejor manera la relación que hay entre estas variables

ingr_idx <- ingr/mean(ingr)*100
gasmon_idx <- gasmon/mean(gasmon)*100

#Calculamos la regresión

relacion <- lm(gasmon_idx~ingr_idx)

regtab <- data.frame(col2 = c(70.797,0.292), col2 = c(0.3213,0.00179),
                     row.names = c("Intercepto", "Pendiente"))
names(regtab) <- c("Parámetro", "Error estándar")

########

knitr::kable(regtab,booktabs = TRUE, format = 'latex', caption = "Regresión Lineal: Consumo - Ingreso", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")


########

figr <- ggplot(relacion,aes(x=log(ingr_idx),y=log(gasmon_idx))) + geom_point(color = "chartreuse4", alpha=0.5) + 
  labs(title = "Ingreso vs Consumo (2020)", x="Ingreso (Logaritmo)",y='Consumo (Logaritmo)', 
      colour = " ") + theme_bw() + geom_smooth(method = lm, color="darkblue", alpha=0.3) 

plot(figr)
```

### (c) 

**Estime una relación entre ingreso y gasto pero para hogares unipersonales de edad entre 30 y 40 años de edad de la Ciudad de México.**

Se filtró la base de datos para considerar a los capitalinos entre 30 y 40 años. Notamos que ahora, la pendiente es de 0.9409, es decir, ¡hay una relación de casi 1 a 1 entre el ingreso y el gasto que se destina al consumo! 

La siguiente tabla resume la regresión y se acompaña con su respectiva gráfica.

```{r echo=F, fig.pos='H', fig.cap="Ingreso y Consumo de los chilangos (30-40 años)"}
#Vamos a filtrar la información de la base de datos

cdmx <- filter(concgast, ubica_geo == 1009, edad_jefe >= 30 & edad_jefe <= 40) 

cdmxg <- as.matrix(cdmx$gasto_mon)

cdmxy <- as.matrix(cdmx$ing_cor)


cg_ind <- cdmxg/mean(cdmxg)*100
cy_ind <- cdmxy/mean(cdmxy)*100

relacioncdmx <- lm(cg_ind~cy_ind)

########

regcdmx <- data.frame(col1 = c(5.90,0.9409), col2 = c(32.86,0.0133),
                     row.names = c("Intercepto", "Pendiente"))

names(regcdmx) <- c("Parámetro", "Error estándar")

knitr::kable(regtab,booktabs = TRUE, format = 'latex', caption = "Regresión Lineal: Consumo - Ingreso", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")


########

figcdmx <- ggplot(relacioncdmx,aes(x=cg_ind,y=cy_ind)) + geom_point(color = "red", alpha=0.7) + 
  labs(title = "Ingreso vs Consumo para \nchilangos entre 30 y 40 años", x="Ingreso ",y='Consumo') + theme_bw() + geom_smooth(method = lm, color="dodgerblue4", alpha=0.1) 

plot(figcdmx)

```


### (d) 

**Para todos los hogares unipersonales, estime el valor promedio del ingreso por edad, separando la muestra en grupos de edad de cinco años cada uno y grafíquelo.**

```{r echo=F}

#Definimos las variables como objetos para poder trabajar con ellas.

gr1 <- filter(concgast, edad_jefe >= 14 & edad_jefe <= 19)
m1 <- mean(gr1$ing_cor)

gr2 <- filter(concgast, edad_jefe >= 20 & edad_jefe <= 25)
m2 <- mean(gr2$ing_cor)

gr3 <- filter(concgast, edad_jefe >= 26 & edad_jefe <= 31)
m3 <- mean(gr3$ing_cor)

gr4 <- filter(concgast, edad_jefe >= 32 & edad_jefe <= 37)
m4 <- mean(gr4$ing_cor)

gr5 <- filter(concgast, edad_jefe >= 38 & edad_jefe <= 43)
m5 <- mean(gr5$ing_cor)

gr6 <- filter(concgast, edad_jefe >= 44 & edad_jefe <= 49)
m6 <- mean(gr6$ing_cor)

gr7 <- filter(concgast, edad_jefe >= 50 & edad_jefe <= 55)
m7 <- mean(gr7$ing_cor)

gr8 <- filter(concgast, edad_jefe >= 56 & edad_jefe <= 61)
m8 <- mean(gr8$ing_cor)

gr9 <- filter(concgast, edad_jefe >= 62 & edad_jefe <= 67)
m9 <- mean(gr9$ing_cor)

gr10 <- filter(concgast, edad_jefe >= 68 & edad_jefe <= 73)
m10 <- mean(gr10$ing_cor)

gr11 <- filter(concgast, edad_jefe >= 74 & edad_jefe <= 79)
m11 <- mean(gr11$ing_cor)

gr12 <- filter(concgast, edad_jefe >= 80 & edad_jefe <= 85)
m12 <- mean(gr12$ing_cor)

gr13 <- filter(concgast, edad_jefe >= 86 & edad_jefe <= 91)
m13 <- mean(gr13$ing_cor)
```

En la siguiente tabla se muestran los grupos por edades y el ingreso promedio por cada grupo. 

```{r echo=FALSE}
grupos <- data.frame(grup = c("14-19","20-25","26-31","32-37","38-43","44-49",
                    "50-55","56-61","62-67","68-73","74-79","80-85","86-91"),
                     colm=c(m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12,m13))

grup <- grupos[,1]
colm <- grupos[,2]
########

names(grupos) <- c("Edad por grupos","Ingreso promedio")
knitr::kable(grupos,booktabs = TRUE, align = "c", format = 'latex', caption = "Ingreso promedio por grupos de edades (2020)", longtable = F
             )%>% kable_styling(latex_options = "HOLD_position")
```

Al graficar estos resultados:

```{r echo=F, fig.cap="Ingreso Promedio por Grupos de Edad (2020)", fig.pos='H'}

figre <- ggplot(grupos,aes(x=grup,y=colm)) + geom_point(color = "darkblue") + 
  labs(title = "Ingreso Promedio por Grupos de Edad (2020)", x="Edad",y='Ingreso Promedio', 
      colour = " ") + theme_bw()

plot(figre)
```
De la figura, se observa que, en promedio, el grupo con mayores ingresos consta de aquellas personas entre 56 y 61 años. Esto nos recuerda a lo observado en la tarea sobre mercados laborales, en los que el mayor salario se asociaba con la etapa más productiva de la vida.

### (e) 

**Interprete sus resultados a la luz de la HIP y comparados con los resultados para las variables agregadas.**

Un resultado importante de la Hipótesis del Ingreso Permanente es que el parámetro estimado para la pendiente de la relación entre consumo e ingreso, ($\hat{b}$), será mayor en tanto las variaciones del ingreso transitorio sean menores (Ver ejercicio 8.2 de los teóricos). Podemos entonces inferir que, en México, hay un fuerte componente de variación en el ingreso transitorio (tenemos una $\hat{b}$ baja para el inciso (a)). Por otra parte, cuando acotamos nuestras observaciones, encontramos un mayor parámetro para los capitalinos entre 30 y 40 años. Esto nos lleva a pensar que el ingreso transitorio varía relativamente poco para este grupo de personas.


\newpage

## Ejercicio 5
**5. Estudie el ``acertijo del premio al riesgo'' para el caso de México siguiendo estos pasos:**


### (a) 

**Consiga los valores anuales de IPC, el Indice de Precios y Cotizaciones de la Bolsa Mexicana de Valores por lo menos desde 1990.**

El índice de Precios y Cotizaciones (en adelante "IPC") es el principal indicador de la evolución del mercado accionario en México. Lo que mide este índice es el rendimiento de las acciones de mayor tamaño y liquidez de empresas que cotizan en la Bolsa Mexicana de Valores. 


| *Tiempo* 	| *IPC*      	| *Tiempo*    	| *IPC*      	|
|:------:	|----------	|------	|----------	|
| 1990   	| 570.14   	| 2006 	| 21074.75 	|
| 1991   	| 1086.08  	| 2007 	| 29713.72 	|
| 1992   	| 1671.61  	| 2008 	| 26859.9  	|
| 1993   	| 1856.24  	| 2009 	| 25306.03 	|
| 1994   	| 2520.65  	| 2010 	| 33285.89 	|
| 1995   	| 2219.36  	| 2011 	| 36340.53 	|
| 1996   	| 3163.18  	| 2012 	| 40037.19 	|
| 1997   	| 4442.42  	| 2013 	| 42060.97 	|
| 1998   	| 4241.03  	| 2014 	| 42644.21 	|
| 1999   	| 5332.09  	| 2015 	| 43770.96 	|
| 2000   	| 6515.86  	| 2016 	| 45901.91 	|
| 2001   	| 6119.71  	| 2017 	| 48995.62 	|
| 2002   	| 6517.99  	| 2018 	| 46730.69 	|
| 2003   	| 7186.92  	| 2019 	| 43066.34 	|
| 2004   	| 10677.26 	| 2020 	| 38704.09 	|
| 2005   	| 14458.61 	| 2021 	| 49487.49 	|

Table: Valores del IPC 1990-2021

### (b) 

**Calcule su tasa de retorno nominal para cada año.**

La tasa de retorno nominal $r^{ipc}$ para cada año está dada por la siguiente ecuación:

$r_t^{ipc}=(V_{t}-V_{t-1} / V_{t-1})*100$

Donde $V_t$ es el valor en $t$ mientras que $V_{t-1}$ es el valor en el periodo anterior. Notemos que la variación para el índice es el rendimiento y que ésta es muy volátil debido a la naturaleza de la bolsa de valores. Nótese, además, que la tendencia es creciente. 

\newpage

| **Tiempo** 	| **$r_t^{ipc}$** 	| **Tiempo** 	| **$r_t^{ipc}$** 	|
|:----------:	|:-------------:	|:----------:	|:-------------:	|
| 1990       	| -             	| 2006       	| 45.76%        	|
| 1991       	| 90.49%        	| 2007       	| 40.99%        	|
| 1992       	| 53.91%        	| 2008       	| -9.60%        	|
| 1993       	| 11.04%        	| 2009       	| -5.79%        	|
| 1994       	| 35.79%        	| 2010       	| 31.53%        	|
| 1995       	| -11.95%       	| 2011       	| 9.18%         	|
| 1996       	| 42.53%        	| 2012       	| 10.17%        	|
| 1997       	| 40.44%        	| 2013       	| 5.05%         	|
| 1998       	| -4.53%        	| 2014       	| 1.39%         	|
| 1999       	| 25.73%        	| 2015       	| 2.64%         	|
| 2000       	| 22.20%        	| 2016       	| 4.87%         	|
| 2001       	| -6.08%        	| 2017       	| 6.74%         	|
| 2002       	| 6.51%         	| 2018       	| -4.62%        	|
| 2003       	| 10.26%        	| 2019       	| -7.84%        	|
| 2004       	| 48.57%        	| 2020       	| -10.13%       	|
| 2005       	| 35.41%        	| 2021       	| 27.86%        	|

Table: Tasa de rendimiento IPC 1990-2021

### (c) 

**Consiga los valores promedio anual de la tasa de interés de CETES a 7 días, o la TIIE, la tasa inter-bancaria de equilibrio, y de la tasa de interés a un año, para el periodo que esté disponible.**

La Tasa de Interés Interbancaria de Equilibrio (en adelante "TIIE") es una tasa de referencia de las operaciones de préstamos, créditos y demás operaciones entre o con instituciones bancarias. Esta tasa es determinada por la autoridad monetaria, Banco de México, y es importante porque es el instrumento que refleja las condiciones del mercado de dinero en moneda nacional. 

| **Tiempo** 	| **TIIE** 	| **Tiempo** 	| **TIIE** 	|
|:----------:	|:--------:	|:----------:	|:--------:	|
|    1995    	|   46.01  	|    2009    	|   5.93   	|
|    1996    	|   33.61  	|    2010    	|   4.91   	|
|    1997    	|   21.91  	|    2011    	|   4.82   	|
|    1998    	|   26.89  	|    2012    	|   4.79   	|
|    1999    	|   24.1   	|    2013    	|   4.28   	|
|    2000    	|   16.96  	|    2014    	|   3.52   	|
|    2001    	|   12.89  	|    2015    	|   3.32   	|
|    2002    	|   8.17   	|    2016    	|   4.47   	|
|    2003    	|   6.83   	|    2017    	|   7.06   	|
|    2004    	|   7.15   	|    2018    	|     8    	|
|    2005    	|   9.61   	|    2019    	|   8.32   	|
|    2006    	|   7.51   	|    2020    	|   5.72   	|
|    2007    	|   7.66   	|    2021    	|   4.62   	|
|    2008    	|   8.28   	|            	|          	|

Table: TIIE 1990-2021

Los Certificados de la Tesorería de la Federación (en adelante "CETES") son un instrumento de deuda bursátil emitido por el Gobierno Federal de México. Son unos bonos que utiliza el Estado Mexicano para financiarse, es decir, son pagarés que emite el Estado y que generan intereses para aquellos que invierten en ellos a ciertos plazos específicos. 

En la siguiente gráfica se muestran los valores promedio anual de la tasas CETES a 28, 91, 182 y 364 días, respectivamente. 

| **Tiempo** 	| **CETES28** 	| **CETES91** 	| **CETES182** 	| **CETES364** 	|
|:----------:	|:-----------:	|:-----------:	|:------------:	|--------------	|
| 1990       	| 34.82       	| 34.95       	| 29.94        	| 24.95        	|
| 1991       	| 19.29       	| 19.84       	| 19.84        	| 19.77        	|
| 1992       	| 15.66       	| 15.93       	| 15.92        	| 16.81        	|
| 1993       	| 14.85       	| 15.41       	| 15.44        	| 15.44        	|
| 1994       	| 14.04       	| 14.51       	| 13.98        	| 13.73        	|
| 1995       	| 48.66       	| 48.54       	| 41.65        	| 37.59        	|
| 1996       	| 31.33       	| 32.85       	| 33.66        	| 34.22        	|
| 1997       	| 19.83       	| 21.25       	| 21.87        	| 22.35        	|
| 1998       	| 24.62       	| 26.04       	| 21.54        	| 22.32        	|
| 1999       	| 21.29       	| 22.26       	| 23.39        	| 24.23        	|
| 2000       	| 15.27       	| 16.16       	| 16.60        	| 16.94        	|
| 2001       	| 11.26       	| 12.19       	| 13.00        	| 13.58        	|
| 2002       	| 7.08        	| 7.43        	| 8.07         	| 8.62         	|
| 2003       	| 6.24        	| 6.53        	| 6.92         	| 7.25         	|
| 2004       	| 6.84        	| 7.13        	| 7.40         	| 7.80         	|
| 2005       	| 9.19        	| 9.32        	| 9.28         	| 9.24         	|
| 2006       	| 7.19        	| 7.29        	| 7.41         	| 7.49         	|
| 2007       	| 7.19        	| 7.36        	| 7.48         	| 7.59         	|
| 2008       	| 7.68        	| 7.89        	| 8.02         	| 8.12         	|
| 2009       	| 5.39        	| 5.47        	| 5.56         	| 5.77         	|
| 2010       	| 4.40        	| 4.57        	| 4.68         	| 4.85         	|
| 2011       	| 4.24        	| 4.35        	| 4.51         	| 4.66         	|
| 2012       	| 4.24        	| 4.38        	| 4.51         	| 4.62         	|
| 2013       	| 3.75        	| 3.81        	| 3.90         	| 3.98         	|
| 2014       	| 3.00        	| 3.12        	| 3.22         	| 3.37         	|
| 2015       	| 2.98        	| 3.14        	| 3.29         	| 3.53         	|
| 2016       	| 4.17        	| 4.36        	| 4.52         	| 4.57         	|
| 2017       	| 6.69        	| 6.88        	| 7.02         	| 7.10         	|
| 2018       	| 7.62        	| 7.83        	| 7.97         	| 8.06         	|
| 2019       	| 7.85        	| 7.94        	| 7.95         	| 7.89         	|
| 2020       	| 5.32        	| 5.33        	| 5.28         	| 4.79         	|
| 2021       	| 4.43        	| 4.64        	| 4.90         	| 5.25         	|

Table: CETES a corto y largo plazo 1990-2021

### (d) 

**Calcule la diferencia entre el retorno del IPC y el retorno de invertir en CETES a distintos plazos.**

```{r warnings=FALSE, include=FALSE}
#Base
ejercicio5<-read.csv("ejercicio_5.csv", sep = ",")


## Calculamos la diferencia entre las series

ipc<-ejercicio5[,6]
cetes<-ejercicio5[,8]

## Calculamos la diferencia 
# Generamos las time series primero
tips<-ts(ipc,start=1990,end=2021,frequency=1)
tcetes<-ts(cetes,start=1990,end=2020,frequency=1)
# La convertimos en carácter numérico:
diferencia<-as.numeric(ipc)-as.numeric(cetes)

```

La diferencia entre los retornos de las series estará dada por la diferencia que existe entre la variación anual del IPC y el rendimiento del CETE. Dicha diferencia se calculó como sigue:

$Diferencia=r_t^{ipc} - r_t^{cetes_i}$

Recuérdese que cada diferencia está dada por la ecuación que sigue:

$r_t^{i}=(V_{t}-V_{t-1} / V_{t-1})*100$

Donde $i\in(ipc, cetes_j)$

Y donde $j\in[{28,91,182,364}]$

La siguiente gráfica muestra las diferencias entre las variaciones de estos dos indicadores, para la tasa de CETES a 28, 91, 182 y 364 días.  

| **Tiempo** 	| **Dif/CETES28** 	| **Dif/CETES91** 	| **Dif/CETES182** 	| **Dif/CETES364** 	|
|:---:	|:---:	|:---:	|:---:	|:---:	|
| 1990 	| - 	| - 	| - 	| - 	|
| 1991 	| 0.712 	| 0.707 	| 0.707 	| 0.707 	|
| 1992 	| 0.383 	| 0.380 	| 0.380 	| 0.371 	|
| 1993 	| -0.0381 	| -0.044 	| -0.044 	| -0.044 	|
| 1994 	| 0.2175 	| 0.213 	| 0.218 	| 0.221 	|
| 1995 	| -0.6061 	| -0.605 	| -0.536 	| -0.495 	|
| 1996 	| 0.112 	| 0.097 	| 0.089 	| 0.083 	|
| 1997 	| 0.2061 	| 0.192 	| 0.186 	| 0.181 	|
| 1998 	| -0.2915 	| -0.306 	| -0.261 	| -0.269 	|
| 1999 	| 0.0444 	| 0.035 	| 0.023 	| 0.015 	|
| 2000 	| 0.0693 	| 0.060 	| 0.056 	| 0.053 	|
| 2001 	| -0.1734 	| -0.183 	| -0.191 	| -0.197 	|
| 2002 	| -0.0057 	| -0.009 	| -0.016 	| -0.021 	|
| 2003 	| 0.0402 	| 0.037 	| 0.033 	| 0.030 	|
| 2004 	| 0.4173 	| 0.414 	| 0.412 	| 0.408 	|
| 2005 	| 0.2622 	| 0.261 	| 0.261 	| 0.262 	|
| 2006 	| 0.3857 	| 0.385 	| 0.384 	| 0.383 	|
| 2007 	| 0.338 	| 0.336 	| 0.335 	| 0.334 	|
| 2008 	| -0.1728 	| -0.175 	| -0.176 	| -0.177 	|
| 2009 	| -0.1118 	| -0.113 	| -0.114 	| -0.116 	|
| 2010 	| 0.2713 	| 0.270 	| 0.269 	| 0.267 	|
| 2011 	| 0.0494 	| 0.048 	| 0.047 	| 0.045 	|
| 2012 	| 0.0593 	| 0.058 	| 0.057 	| 0.056 	|
| 2013 	| 0.013 	| 0.012 	| 0.012 	| 0.011 	|
| 2014 	| -0.0161 	| -0.017 	| -0.018 	| -0.020 	|
| 2015 	| -0.0034 	| -0.005 	| -0.007 	| -0.009 	|
| 2016 	| 0.007 	| 0.005 	| 0.004 	| 0.003 	|
| 2017 	| 0.0005 	| -0.001 	| -0.003 	| -0.004 	|
| 2018 	| -0.1224 	| -0.125 	| -0.126 	| -0.127 	|
| 2019 	| -0.1569 	| -0.158 	| -0.158 	| -0.157 	|
| 2020 	| -0.1545 	| -0.155 	| -0.154 	| -0.149 	|
| 2021 	| 0.2343 	| 0.232 	| 0.230 	| 0.226 	|

Table: Diferencia entre rendimiento IPC y CETES 1990-2021

Nótese lo siguiente: i. Al ser una diferencia entre tasas (expresadas en porcentaje) las unidades de estas diferencias son también porcentajes. Esto implica que la diferencia entre las variaciones es muy alta, lo mismo para los valores positivos de la diferencia que para los valores negativos. 

### (e) 

**Calcule la covarianza entre dicha diferencias y  la tasa de crecimiento real del consumo agregado de la economía mexicana.**

La covarianza está dada por la siguiente ecuación:

$\sigma_{x,y}=\frac{1}{n-1}\sum_{i=n}^{n}(x_i-\overline{x})(y_i-\overline{y})$

Donde $x=$ diferencia entre el rendimiento del IPC y del $CETES_i$ y $y=$variación real del consumo agregado, donde $i\in[{28,91,182,364}]$ días. 

La covarianza se resume en la siguiente gráfica. 

|  	| **CETES28** 	| **CETES91** 	| **CETES182** 	| **CETES364** 	|
|:---:	|:---:	|:---:	|:---:	|---	|
| Covarianzas 	| 0.002177 	| 0.002107 	| 0.002043 	| 0.001938 	|

Table: Covarianza entre rendimiento y diferencia

Nótese que la covarianza es relativamente menor para todas las observaciones. Esto indica que no existe una variación conjunta entre las diferencias en el rendimiento del IPC y de los distintos CETES con el consumo agregado de la economía. 

### (f) 

**Calcule el valor de aversión relativa al riesgo que implican estos números, dado el supuesto de una utilidad con forma ARRC.**

Sabemos que el coeficiente de aversión relativa al riesgo $\theta$ está definido como sigue: 

$\theta=\frac{E[r^i]-E[r^j]}{\sigma_{r^i-r^j, g^c}}$

Este coeficiente se interpreta como el inverso de la elasticidad de sustitución intertemporal. Nótese que $E[r^i]-E[r^j]$ es la diferencia de los valores esperados de la tasa de interés pasivas y $g^c$ representa el cambio en el consumo nacional. 

|  	| **CETES28** 	| **CETES91** 	| **CETES182** 	| **CETES364** 	|
|:---:	|:---:	|:---:	|:---:	|---	|
| Covarianzas 	| 0.002177 	| 0.002107 	| 0.002043 	| 0.001938 	|
| COEF ARRC 	| 29 	| 28 	| 30 	| 31 	|

Table: Cálculo del Coeficiente de Aversión al Riesgo

Nótese que el coeficiente es una medida de aversión al riesgo para el país, dado el supuesto de una utilidad con rendimientos constantes. Nótese, además, que este coeficiente de aversión es mayor al riesgo que el calculado por Romer para USA, para el periodo de análisis. Esto implica que en México los consumidores prefieren un escenario con menor incertidumbre en $t$ que uno con mayor incertidumbre pero en $t+1$. 

Notemos que la variación del coficiente de aversión al riesgo no es tan grande, pues para el corto plazo (28 días) es de 29 mientras que para el largo plazo (364 días) es de 31, es decir, varía, básicamente, en 2 puntos. 

### (g) 

**Ahora calcule la covarianza entre dicha diferencias y  la tasa de crecimiento real del consumo agregado DE BIENES IMPORTADOS [aquí hay una serie: www.inegi.org.mx/temas/imcp/] de la economía mexicana.**

Las variaciones del consumo importado están dadas por la siguiente gráfica: 

| **Tiempo** 	| **CNI** 	| **Tiempo** 	| **CNI** 	|
|:---:	|:---:	|:---:	|:---:	|
| 1994 	| 24.74% 	| 2009 	| 5.01% 	|
| 1995 	| -50.64% 	| 2010 	| -1.30% 	|
| 1996 	| 64.08% 	| 2011 	| 12.49% 	|
| 1997 	| 28.63% 	| 2012 	| 3.99% 	|
| 1998 	| -14.20% 	| 2013 	| 7.88% 	|
| 1999 	| 20.01% 	| 2014 	| 3.49% 	|
| 2000 	| 58.45% 	| 2015 	| 8.55% 	|
| 2001 	| 3.12% 	| 2016 	| -1.44% 	|
| 2002 	| -2.68% 	| 2017 	| 10.88% 	|
| 2003 	| 12.54% 	| 2018 	| -3.34% 	|
| 2004 	| 16.56% 	| 2019 	| 2.76% 	|
| 2005 	| 11.08% 	| 2020 	| 0.86% 	|
| 2006 	| 4.98% 	| 2021 	| 13.41% 	|
| 2007 	| 4.88% 	|  	|  	|
| 2008 	| -15.37% 	|  	|  	|

Table: Tasa de variación de consumo importado 1994-2021

La covarianza está dada por la siguiente ecuación:

$\sigma_{x,y}=\frac{1}{n-1}\sum_{i=n}^{n}(x_i-\overline{x})(y_i-\overline{y})$

Donde $x=$ diferencia entre el rendimiento del IPC y del $CETES_i$ y $y=$variación real del consumo agregado, donde $i\in[{28,91,182,364}]$ días. 

La covarianza se resume en la siguiente gráfica. 

|  	| **CETES28** 	| **CETES91** 	| **CETES182** 	| **CETES364** 	|
|:---:	|:---:	|:---:	|:---:	|---	|
| Covarianzas 	| 0.02582 	| 0.025312 	| 0.023175 	| 0.022138 	|

Table: Covarianza entre diferencia y consumo agregado

Nótese que la covarianza es relativamente menor para todas las observaciones. Esto indica que no existe una variación conjunta entre las diferencias en el rendimiento del IPC y de los distintos CETES con el consumo agregado importado de la economía. 


### (h) 

**Calcule el valor de aversión relativa al riesgo que implican estos números, dado el supuesto de una utilidad con forma ARRC.**

Si calculamos ahora el coeficiente con las variaciones del índice de consumo agregado pero importado, tenemos los siguientes resultados:

|  	| **CETES28** 	| **CETES91** 	| **CETES182** 	| **CETES364** 	|
|:---:	|:---:	|:---:	|:---:	|---	|
| Covarianzas 	| 0.02582 	| 0.025312 	| 0.023175 	| 0.022138 	|
| COEF ARRC 	| 2.460441 	| 2.354856 	| 2.641175 	| 2.724758 	|

Table: Cálculo de Coeficiente de Aversión al Riesgo (2)

Nótese que la variación del coeficiente de aversión al riesgo es también menor. Para el corto plazo (28 días) el valor del coeficiente es de 2.46 mientras que el de largo plazo (364 días) el valor es de 2.72. 

### (i) 

**Interprete sus resultados.**

Los resultados son consistentes con lo revisado en la literatura y, particularmente, con lo que indican los resultados de Romer. Nótese que los resultados para la $\theta$ en México son mayores que los calculados para el caso de Estados Unidos. Nótese, además, que las variaciones en los resultados para los distintos niveles de aversión al riesgo son pequeñas y esto nos lleva a concluir que hay consistencia entre las observaciones.

\newpage

## Ejercicio 6
**6. Utilice el método del árbol binomial para, primero, explicar el precio P=80 de un activo y, después, valuar un "call" sobre dicho activo, con precio de ejercicio K=P-N donde N es el número de su equipo, (Grupo 1, use N=1, Grupo 2, use N=2, etc) asumiendo una tasa de interés de 5 por ciento:**

Resulta intuitivo representar el problema de la valuación de opciones mediante un "árbol" en donde se consideran distintos escenarios. En la siguiente figura, el primer nodo del árbol izquierdo contempla el precio actual del activo subyacente, el cual puede ser una acción, commodity, metal, entre otros. Los siguientes nodos representan los dos valores que puede tomar tal activo en el siguiente periodo, $t=1$, es decir, los posibles estados de la naturaleza. En particular, el activo puede subir de precio (apreciarse) o bajar de precio (depreciarse). 

```{r echo=F, fig.cap= "Representación del Modelo Binomial", fig.pos='H'}
imagen1 <- ggdraw() + draw_image("general.png", scale=0.9)
imagen1
```
Por otra parte, el árbol de la derecha representa los pagos de la opción en ambos estados de la naturaleza. Es importante notar que si el activo subyacente se deprecia, entonces no se ejerce la opción, por lo que el pago de la opción será igual a cero y la pérdida consistirá en el precio que pagó el inversionista para ser acreedor de tal opción.  Si la opción se ejerce, el pago que se recibe es $D_1(+)=S_1(+)-K=S_1(+)-79$, en donde $K=S_0-1$ (porque éste es el equipo 1). El tema de interés es, justamente, obtener un valor confiable que nos diga cuál debería ser ese precio de entrada (o precio de la opción), dado que se contemplan dos estados de la naturaleza. En otras palabras, queremos calcular el valor de $D_0$.

El pago que brinda la opción puede resumirse mediante las siguientes ecuaciones, en las cuales suponemos que $S_1(+)>S_1(-)$:

$$
D_1(+) = max\{0, S_1(+)-K\} = max\{0,S_1(+)-79\}= S_1(+)-79. \\
$$
$$
D_1(-) = max\{0, S_1(-)-K\} = max\{0,S_1(-)-79\}=0.
$$

en donde $S_1(+)$ representa el precio del activo subyacente en el estado de la naturaleza en donde se aprecia, $S_1(-)$ representa el precio del subyacente en el estado de la naturaleza en que se deprecia. 

En este ejercicio consideraremos una serie de valores que representan una apreciación y otra en donde el subyacente se deprecia con el objetivo de observar más detalladamente el precio de la opción.

```{r, echo=F}
#Generemos un conjunto de precios números aleatorios para representar los posibles valores del activo en el siguiente periodo.
set.seed(20)
pos <- floor(runif(20, min=81, max=110))
neg <- floor(runif(20, min=50, max=79))

#Nota: se fijó una semilla al inicio del ejercicio 2, lo que permitirá la replicabilidad.

```


Resulta conveniente incorporar en este ejercicio el uso de una "técnica de arbitraje", apodada *Delta Hedging*. Tal técnica involucra *cubrir* la opción (*hedge the option*) con el activo suficiente para generar un portafolio libre de riesgo. Entonces, el portafolio consistirá en una proporción que se invierte en el activo subyacente, denotada por $\Delta$ y en una posición en una opción *call*:
$$
V_t = \Delta S_t - D_t
$$
en donde $V_t$ es el valor del portafolio en el tiempo $t$. Para que tal estrategia sea libre de riesgo, debe valer lo mismo en $t=1$ bajo todo estado de la naturaleza. Por tanto, tenemos la siguiente identidad:

$$
\Delta S_1(+)-D_1(+)=\Delta S_1(-)-D_1(-)
\iff 
\Delta^*=\frac{S_1(+)-79}{S_1(+)-S_1(-)}.
$$

Obtuvimos un valor de $\Delta$ que permite que el valor del portafolio en el periodo $t=1$ sea el mismo sin importar si le va bien o mal al activo subyacente. Es decir:

$$
\text{Apreciación:} \quad V_{1A}=\Delta^* S_1(+)-D_1(+) = \left ( \frac{S_1(+)-79}{S_1(+)-S_1(-)} \right ) S_1(+)-(S_1(+)-79)
$$
$$
\text{Depreciación:} \quad V_{1D}=\Delta^* S_1(-)-D_1(-) = \left ( \frac{S_1(+)-79}{S_1(+)-S_1(-)} \right ) S_1(-)
$$
Notar que si consideramos, por ejemplo, $S_1(+)=106$. $S_1(-)=64$, entonces $\Delta^* = 27/42=0.642$.Luego, tenemos:

$$
 V_{1A} = V_{1D} = \alpha^*
$$
En donde $\alpha^*$ denota el valor del portafolio en el siguiente periodo. Siguiendo el ejemplo ilustrativo, si se consideran los precios $S_1(+)=106$ y $S_1(-)=64$, tendríamos:
$$
 V_{1A}= \Delta^* S_1(+)-D_1(+) = \left ( \frac{S_1(+)-79}{S_1(+)-S_1(-)} \right )S_1(+)-(S_1(+)-79) = (0.6428)(106)-27= \textbf{41.14}.
$$
$$
 \text{y} \quad V_{1D}= \Delta^* S_1(-)-D_1(-) = \left ( \frac{S_1(+)-79}{S_1(+)-S_1(-)} \right )S_1(-) = (0.6428)(64)-0= \textbf{41.14}.
$$
El valor del portafolio en el siguiente periodo (no importa la unidad: puede ser 1 día, 1 mes, 1 año, 1 década) valdrá, con toda probabilidad, $\alpha^*$ (i.e. $Prob(V_1=\alpha^*)=1$). En efecto, las condiciones arriba mencionadas se cumplen y, a estos precios, $Prob(V_1=41.14)=1$.


```{r, echo=F}
#Construimos un data frame en donde se consideren ambos escenarios.

states <- data.frame("Apreciación"=pos,"Depreciación"=neg)
apr <- states[,1]
dpr <- states[,2]

states <- mutate(states, delta = (apr-79)/(apr-dpr))

#Valor del portafolio con certidumbre
dlt <- states[,3]

states <- mutate(states, valor_t1 = dlt*apr-(apr-79))

```

Ahora bien, el valor del portafolio en el periodo inicial puede verse como el valor del portafolio en el siguiente periodo *descontado* por una tasa de interés libre de riesgo, que en este caso es del 5\%.

$$
V_0 = \frac{V_1}{1+r} \iff \Delta^*S_0-D_0=\frac{\alpha^*}{1.05} \iff D_0^*= \Delta^*80- \frac{\alpha^*}{1.05}
$$
En donde $D_0^*$ es el precio que debe tener la opción, dados los estados de la naturaleza. Por ejemplo, para el escenario en que el precio del subyacente pudiera subir a 106, o bien caer a 64, el precio de la opción sería igual a:

$$
D_0^*=(0.6428)(80)-\frac{41.14}{1.05}= \textbf{12.24}.
$$
Resumamos lo anterior en una tabla en donde se consideran 20 escenarios.

```{r, echo=F}
states <- mutate(states, prima = (dlt*80)-(valor_t1/1.05))
states <- mutate(states, escenario = c(1:20))
escenario <- states[,6]

names(states) <- c("Apreciación","Depreciación","Delta","Valor en t=1","Precio de la opción","Escenario")

states <- states %>% relocate(Escenario, .before="Apreciación")

knitr::kable(
  states, booktabs = TRUE, align = "c",format = 'latex', digits = 2,
  caption = "Precio de la opción para 20 escenarios"
)%>%
  kable_styling(latex_options = "HOLD_position")

```

```{r echo=F, fig.cap= "Representación gráfica del modelo para el escenario 1"}
imagen2 <- ggdraw() + draw_image("ejerc.png", scale=0.9)
imagen2
```


